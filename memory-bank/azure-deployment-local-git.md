# Azure App Service Deployment via Local Git Push (shopify-lugdi)

This document summarizes the configuration and steps for deploying the `shopify-lugdi` Next.js application to Azure App Service (Linux) using the Local Git Push method.

**Deployment Method:** Local Git Push

**Key Observation:** Although a custom `deploy.sh` script was created and environment variables (`DEPLOYMENT_SOURCE`) were set to try and force its execution, Azure's built-in build system (Oryx) ultimately handled the build process successfully after the `NPM_CONFIG_LEGACY_PEER_DEPS=true` environment variable was set. The custom deployment scripts (`deploy.sh`, `deploy.cmd`) and the `.deployment` file appear to be unused in the current working configuration.

## Prerequisites

1.  Node.js installed locally.
2.  Git installed locally.
3.  Azure CLI (Optional, but useful for management).

## Azure App Service Configuration (`lugdi`)

Navigate to the Azure Portal -> App Services -> `lugdi`.

1.  **Deployment Credentials:**

    - Set up under **Deployment Center** -> **Local Git/FTPS Credentials** tab.
    - Use **Application scope** credentials.
    - Username: `$lugdi`
    - Password: (Auto-generated by Azure, viewable in the portal)
    - _Note: These credentials are typically prompted for by Git on the first push and then cached locally by the Git Credential Manager._

2.  **Environment Variables:**

    - Set under **Configuration** -> **Environment variables** tab (previously "Application settings").
    - `DEPLOYMENT_BRANCH` = `main` (Tells Azure which branch to deploy from the pushed code).
    - `NPM_CONFIG_LEGACY_PEER_DEPS` = `true` (Ensures Oryx's preliminary `npm install` step succeeds despite peer dependency conflicts).
    - _Ensure `SCM_DO_BUILD_DURING_DEPLOYMENT` and `DEPLOYMENT_SOURCE` variables are **removed** or not present._

3.  **Startup Command:**
    - Set under **Configuration** -> **General settings** tab.
    - Likely set to `npx next start -p $PORT` or potentially `node server.js`. _(Confirmation recommended, but the current setting allows the deployed app to run)._ If empty, Azure uses a default mechanism.

## Local Repository Configuration (`shopify-lugdi`)

1.  **`next.config.ts`:** Ensure `output: 'standalone'` is set (already configured).
2.  **`.deployment` file:** This file should be **removed** from the repository (already done).
3.  **`deploy.sh` / `deploy.cmd`:** These files currently exist but seem **unused** by the successful deployment process. They can be kept for reference or removed.
4.  **Git Remote:** Add the Azure deployment endpoint as a remote:
    ```bash
    git remote add azure https://lugdi-dnf4hxd9bzacfxgy.scm.centralindia-01.azurewebsites.net:443/lugdi.git
    ```
    _(Verify with `git remote -v`)_

## Deployment Steps

1.  Make desired code changes in your local repository.
2.  Stage the changes:
    ```bash
    git add .
    ```
3.  Commit the changes:
    ```bash
    git commit -m "Your descriptive commit message"
    ```
4.  Push to Azure to trigger deployment:
    ```bash
    git push azure master:main
    ```
    _(Note: Pushing local `master` branch to the remote `main` branch, as configured by `DEPLOYMENT_BRANCH`)_.
    _(Enter Deployment Credentials if prompted by Git, though they are likely cached)._
